<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Gratweet?</title>
		<script type="text/javascript" src="js/vendor/d3.v3.js"></script>
		<script type="text/javascript" src="js/vendor/jquery-1.11.0.js"></script>
		<link href="jquery.tweet.css" rel="stylesheet"/>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
		 <script type="text/javascript" charset="utf-8" src="/twitter/jquery.tweet.js"></script> 
		<link rel="stylesheet" type="text/css" href="css/body.css">
		<link rel="stylesheet" type="text/css" href="css/barchart.css">
		<link rel="stylesheet" type="text/css" href="css/map.css">
		<link rel="stylesheet" type="text/css" href="css/feed.css">
		<script type="text/javascript">
			function randomString(length) {
			  var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'.split('');
			  var str = '';
			  for (var i = 0; i < length; i++) {
				str += chars[Math.floor(Math.random() * chars.length)];
			  }
			  return str;
			}
			var rnd = randomString(8);

			jQuery(function($) {
			  $(".rnd").replaceWith(rnd);


			  $(".demo .code").hide().each(function(i,e){
				$(e).before($('Twitter feed').
							  click(function(ev) {
								$(e).slideToggle();
								$(this).hide();
								ev.preventDefault();
							  }));

			  }).each(function(i, e){ eval($(e).text()); });
			});
		</script>
		<script>//tweet-text processing script
			
			//maak variabelen aan voor text processing
			var tweet_text = document.getElementsByClassName("tweet_text");
			var tweet_text_raw = new Array();
			var tokenised_tweets = new Array();
			var tokens = new Array();//voor later
			var hashtags = new Array();
			var ats = new Array();// an array to contain everything starting with @ (e.g. @vu_amsterdam, @home)
			var stopwords = ["gratis","pic","bit","goo","iturl","aan", "afd", "als", "bij", "dat", "de", "den", "der", "des", "deze","die", "dit", "dl", "door", "dr", "ed", "een", "en","er", "enige", "enkele",
								"enz", "et", "etc", "haar", "het", "hierin", "hoe", "hun", "ik", "in", "inzake", "is", "je", "met", "na", "naar", "nabij", "niet", "no","nog", "nu", "of",
								"om", "onder", "ons", "onze", "ook", "oorspr", "op", "over", "pas", "pres", "prof", "publ", "sl", "st", "te", "tegen", "ten", "ter", "tot", "uit", "uitg",
								"vakgr", "van", "vanaf", "vert", "vol", "voor", "voortgez", "voortz", "wat", "wie", "zijn"];
			
			function processText(){
					
				//haal de text uit de node objecten en stop ze in array
				for (i=0;i<tweet_text.length;i++)
				{
				  if (tweet_text.item(i).nodeType==1)
				  {
					tweet_text_raw.push(tweet_text.item(i).innerText);//innerHTML of andere methods kunnen ook hier
				  }
				}
				
				//print de text voor testen in <p id='textHolder'></p>
				document.getElementById('textHolder').innerHTML = tweet_text_raw;
				
				//functie om string op te splitsen
				function splitString(string, separator) {
					var arrayOfStrings = string.split(separator);
					tokenised_tweets.push(arrayOfStrings);
				}
				
				//tokenize elke tweet (op basis van een spatie)
				for (var i=0; i < tweet_text_raw.length; i++){
					splitString(tweet_text_raw[i], " ");
				};
				
				//haal hashtags uit de tweets
				//het is misschien leuk om met de hashtags een soort van 'now trending' te maken 
				//momenteel is de hashtag happyhour en minecraft trending bijv.
				for (var i=0; i < tokenised_tweets.length; i++){
					for (var j=0; j < tokenised_tweets[i].length; j++){
						var token = tokenised_tweets[i][j];
						var hashtag = token.match(/(#\w+)/g);
						var at = token.match(/(@\w+)/g);
						var url = token.match(/\w{2}[.]\w{2}/g); //door websites als google.nl kan de url regex niet specifieker dan dit worden
						var word = token.match(/([a-z,A-z]+)/g);
						
						//remove the hashtags and url's from the tokenised_tweets for further processing
						if(hashtag != null || url != null){delete tokenised_tweets[i][j];}
						
						//if match and not #gratis, then add to hashtags array 
						if(hashtag != null && hashtag[0].toLowerCase() !="#gratis"){
							hashtag = hashtag[0].substring(1);//haal de hashtag zelf weg voor string matchen en tellen later
							hashtags.push(hashtag);
						}
						
						//remove the @'s from the tokenised_tweets and add them to ats array for further processing
						if(at != null){
							at = at[0].substring(1);
							ats.push(at)
							delete tokenised_tweets[i][j];
						}
						
						//remove anything that isn't a word for further processing (woorden die eindigen met een ? . ! ofzo staan nog in tokenized_tweets, maar zijn bij tokens array eruit gehaald)
						if(word === null){
							delete tokenised_tweets[i][j];							
						}
						else{
						tokenised_tweets[i][j] = word[0];
						}
						
						var token = tokenised_tweets[i][j];//dit moet hier staan om een of andere reden... anders werk onderstaande niet
						
						if (typeof(token) != "undefined"){ //doordat ik delete gebruik blijven op sommige plekken (een hastag bijv.) undefined plekken over
							for (var k=0; k < stopwords.length; k++){
								
								//remove the stopwords from the tokenised_tweets for further processing
								if(token.toLowerCase() === stopwords[k]){//(stopword != null){
									delete tokenised_tweets[i][j];
								}							
							};
						
						}
					};				
				};		
			}

		</script>
	</head>
	<body  onload=processText()><!--/ onmousemove=processText() om dynamisch tweets te verwerken/-->
		<div id='logo'>
			<img src='images/logo.png' border='0' />
		</div>
		<div id='feed' style="overflow: auto;">
			Twitter feed
			<div class="demo" ><!--/https://twitter.com/search?q = ... zie https://twitter.com/search-home voor de opties /-->
				<pre class="code">
					jQuery(function($){
						$("#query").tweet({
							avatar_size: 32,
							count: 100,
							query: "-sex -#sexdating -milf -geil -erotisch -erotische #gratis lang:nl",
							refresh_interval: 30,
							loading_text: "searching twitter..."
						});
					});
				</pre>
				<!--/$('.tweet_even').get()/-->
				<div id="query" class='query'></div>
			</div>
		</div>
		<div id='map'>
			Map
			  <div class="demo"><!--/1.1 api aan roepen met twitter_search_url (zie jquery.tweet.js) en geo krijgen lukt mij niet, zou wel moeten kunnen volgens comments in de tweet.js github(https://github.com/StanScates/Tweet.js-Mod_) /-->
				<pre class="code">
					jQuery(function($){
						$(".tweet").tweet({
							avatar_size: 32,
							count: 100,							
							twitter_search_url: "api.twitter.com/1.1/search/tweets.json?q=%23gratis",
							loading_text: "searching twitter..."
						});
					});
				</pre>
				<div class='tweet query'></div>
			</div>			
		</div>
		<div id='barchart'>
			Barchart
			<p id='textHolder'></p> 
		</div>
		
		<script type="text/javascript" src="js/feed.js"></script>
		<script type="text/javascript" src="js/map.js"></script>
		<script type="text/javascript" src="js/barchart.js"></script>
	</body>
</html>

 







